<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gwak-GPT</title>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js'></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #FFD700;
            --secondary-color: #FFA500;
            --background-color: #FFFFFF;
            --text-color: #333333;
            --message-bg: #FFFAF0;
            --self-message-bg: #FFFFE0;
        }

        * {
            font-family: 'Noto Sans KR', sans-serif;
            box-sizing: border-box;
        }

        body {
            background-color: var(--background-color);
            margin: 0;
            padding: 20px;
            color: var(--text-color);
        }

        .chat-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .chat-header {
            background-color: var(--primary-color);
            color: var(--text-color);
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
        }

        #msgs {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
            background-color: var(--background-color);
        }

        #msgs ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #msgs li {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
            clear: both;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #msgs li.message {
            background-color: var(--message-bg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            float: left;
        }

        #msgs li.message.self {
            background-color: var(--self-message-bg);
            float: right;
        }

        #msgs li.control {
            background-color: var(--secondary-color);
            color: var(--text-color);
            text-align: center;
            margin: 10px auto;
            float: none;
            font-style: italic;
        }

        .user {
            font-weight: 700;
            margin-right: 8px;
            color: var(--secondary-color);
        }

        .time {
            font-size: 0.8em;
            color: #999;
            margin-right: 12px;  /* 시간과 사용자 이름 사이의 간격 증가 */
            display: inline-block;  /* 줄바꿈 방지 */
        }

        #input {
            display: flex;
            padding: 15px;
            background-color: #fff;
            border-top: 1px solid #e0e0e0;
        }

        #message {
            flex-grow: 1;
            padding: 12px;
            border: 2px solid var(--primary-color);
            border-radius: 24px;
            margin-right: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        #message:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        #send-btn {
            background-color: var(--primary-color);
            color: var(--text-color);
            border: none;
            padding: 12px 24px;
            border-radius: 24px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: background-color 0.3s ease;
        }

        #send-btn:hover {
            background-color: var(--secondary-color);
        }

        #ask {
            text-align: center;
            margin-bottom: 30px;
        }

        #name {
            padding: 12px;
            border: 2px solid var(--primary-color);
            border-radius: 24px;
            margin-right: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        #name:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        #join-btn {
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: var(--text-color);
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: background-color 0.3s ease;
        }

        #join-btn:hover {
            background-color: var(--secondary-color);
        }

        @media (max-width: 600px) {
            .chat-container {
                border-radius: 0;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            #msgs {
                flex-grow: 1;
            }

            #input {
                position: sticky;
                bottom: 0;
            }
        }
    </style>
</head>
<body>
    <div id="ask">
        <input type="text" id="name" placeholder="닉네임을 입력하세요" aria-label="닉네임 입력" />
        <button id="join-btn">채팅방 입장</button>
    </div>
    <main class="chat-container" id="channel" style="display: none;">
        <header class="chat-header" role="banner">
            Gwak-gpt
        </header>
        <section id="msgs" role="log" aria-live="polite">
            <ul>
                <li class="message" style="display: none">
                    <span class="time"></span><span class="user"></span><span class="message"></span>
                </li>
            </ul>
        </section>
        <footer id="input">
            <input type="text" id="message" placeholder="메시지를 입력하세요..." aria-label="메시지 입력" />
            <button id="send-btn" aria-label="메시지 전송">전송</button>
        </footer>
    </main>

    <script>
        $(document).ready(function () {
            if (typeof WebSocket == 'undefined') {
                alert('이 브라우저는 WebSocket을 지원하지 않습니다.');
                return;
            }

            $('#join-btn').click(function () {
                join($('#name').val());
                $('#ask').hide();
                $('#channel').show();
                $('#message').focus();
            });

            $('#name').keydown(function (event) {
                if (event.keyCode == 13) {
                    $('#join-btn').click();
                }
            });

            function join(name) {
                var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
                var ws_path = ws_scheme + '://' + window.location.host;
                var ws = new WebSocket(ws_path);

                var container = $('#msgs');
                ws.onmessage = function (evt) {
                    var obj = JSON.parse(evt.data);
                    if (typeof obj != 'object') return;

                    var action = obj['action'];
                    var msg = $('<li>').addClass(action);
                    msg.append($('<span>').addClass('time').text(new Date().toLocaleTimeString()));

                    if (action == 'message') {
                        msg.append($('<span>').addClass('user').text(obj['user']));
                        msg.append($('<span>').addClass('message').text(': ' + obj['message']));
                        if (obj['user'] == name) msg.addClass('self');
                    } else if (action == 'control') {
                        msg.append($('<span>').addClass('message').text(obj['user'] + ' ' + obj['message']));
                    }

                    container.find('ul').append(msg);
                    container.scrollTop(container[0].scrollHeight);
                }

                $('#send-btn').click(function () {
                    sendMessage();
                });

                $('#message').keydown(function (event) {
                    if (event.keyCode == 13) {
                        sendMessage();
                    }
                });

                function sendMessage() {
                    var input = $('#message');
                    var msg = input.val();
                    if (msg) {
                        ws.send(JSON.stringify({ action: 'message', user: name, message: msg }));
                    }
                    input.val('');
                }
            }
        });
    </script>
</body>
</html>